<app-pop
  *ngIf="showPop"
  [reportId]="selectedReportId"
  (close)="showPop = false"
></app-pop>
<div class="reports-page">
  <div class="header">
    <h2>Reports</h2>
  </div>

  <div class="top">
    <div class="tabs" role="tablist">
      <button
        *ngFor="let t of tabs"
        type="button"
        class="tab"
        [class.active]="t === activeFilter"
        (click)="setFilter(t, 1)"
        [attr.aria-pressed]="t === activeFilter"
      >
        {{ t }}
      </button>
    </div>
    <div class="pagination-controls" *ngIf="pagination">
      <button
        class="page-btn"
        aria-label="Previous page"
        (click)="prevPage()"
        [disabled]="!pagination?.prev_page_url"
      >
        ‹
      </button>

      <button
        class="page-btn"
        [class.active]="currentPage === 1"
        (click)="goToPage(1)"
      >
        1
      </button>

      <span *ngIf="currentPage > 2" class="page-ellipsis">…</span>

      <button
        *ngIf="currentPage !== 1 && currentPage !== pagination?.last_page"
        class="page-btn active"
        disabled
      >
        {{ currentPage }}
      </button>

      <span
        *ngIf="currentPage < pagination?.last_page - 1"
        class="page-ellipsis"
        >…</span
      >

      <button
        *ngIf="1 < pagination?.last_page"
        class="page-btn"
        [class.active]="currentPage === pagination.last_page"
        (click)="goToPage(pagination?.last_page)"
      >
        {{ pagination?.last_page }}
      </button>

      <button
        class="page-btn"
        aria-label="Next page"
        (click)="nextPage()"
        [disabled]="!pagination?.next_page_url"
      >
        ›
      </button>
    </div>
  </div>

  <table class="reports-table">
    <colgroup>
      <col style="width: 15%" />
      <col style="width: 15%" />
      <col style="width: 15%" />
      <col style="width: 55%" />
    </colgroup>
    <thead>
      <tr>
        <th>Reporter</th>
        <th>Property</th>
        <th>Date</th>
        <th>Details</th>
      </tr>
    </thead>
    <tbody>
      <ng-container *ngIf="activeFilter === 'Properties'">
        <tr *ngFor="let report of propertyReports">
          <td class="goToDetails" (click)="openPop(report.id)">
            {{ report.user.first_name + " " + report.user.last_name }}
          </td>
          <td>{{ "Info" }}</td>
          <td>{{ report.created_at | date : "mediumDate" }}</td>
          <td>
            {{ report.additional_comments }}
          </td>
        </tr>
      </ng-container>
      <ng-container *ngIf="activeFilter === 'Service Provider'">
        <tr *ngFor="let report of serviceReports">
          <td>
            {{ report.user.first_name + " " + report.user.last_name }}
          </td>
          <td>{{ "Info" }}</td>
          <td>{{ report.created_at | date : "mediumDate" }}</td>
          <td>
            {{ report.additional_comments }}
          </td>
        </tr>
      </ng-container>
    </tbody>
  </table>

  <!-- Mobile view -->
  <div class="reports-cards">
    <div class="report-card" *ngFor="let report of propertyReports">
      <div class="top">
        {{ report.user.first_name + " " + report.user.last_name }}

        <div class="info">
          <div class="name">{{ "Info" }}</div>
          <div class="email">{{ report.additional_comments }}</div>
        </div>
      </div>
      <div class="row">
        <span class="label">Date Submitted:</span>
        <span class="value">{{ report.created_at | date : "mediumDate" }}</span>
      </div>
      <div class="row">
        <span class="label">Status:</span>
        <span class="value status-counters">
          <span class="status approved">
            {{ report.status }}
          </span>
        </span>
      </div>
    </div>
  </div>
</div>
