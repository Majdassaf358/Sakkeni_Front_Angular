<div class="providers-status">
  <div class="header">
    <h2>Service Providers Status</h2>
    <span [ngClass]="topStatusClass">{{ topStatusLabel }}</span>
  </div>

  <div class="top">
    <div class="tabs" role="tablist">
      <button
        *ngFor="let t of tabs"
        type="button"
        class="tab"
        [class.active]="t === activeFilter"
        (click)="setFilter(t, 1)"
        [attr.aria-pressed]="t === activeFilter"
      >
        {{ t }}
      </button>
    </div>
    <div class="pagination-controls" *ngIf="pagination">
      <button
        class="page-btn"
        aria-label="Previous page"
        (click)="prevPage()"
        [disabled]="!pagination?.prev_page_url"
      >
        ‹
      </button>

      <button
        class="page-btn"
        [class.active]="currentPage === 1"
        (click)="goToPage(1)"
      >
        1
      </button>

      <span *ngIf="currentPage > 2" class="page-ellipsis">…</span>

      <button
        *ngIf="currentPage !== 1 && currentPage !== pagination?.last_page"
        class="page-btn active"
        disabled
      >
        {{ currentPage }}
      </button>

      <span
        *ngIf="currentPage < pagination?.last_page - 1"
        class="page-ellipsis"
        >…</span
      >

      <button
        *ngIf="1 < pagination?.last_page"
        class="page-btn"
        [class.active]="currentPage === pagination.last_page"
        (click)="goToPage(pagination?.last_page)"
      >
        {{ pagination?.last_page }}
      </button>

      <button
        class="page-btn"
        aria-label="Next page"
        (click)="nextPage()"
        [disabled]="!pagination?.next_page_url"
      >
        ›
      </button>
    </div>
  </div>

  <table class="providers-table">
    <thead>
      <tr>
        <th>Service Provider</th>
        <th>Owner</th>
        <th>Date</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody>
      <!-- All -->
      <ng-container *ngIf="activeFilter === 'All'">
        <tr *ngFor="let a of all">
          <td class="goToDetails" (click)="goTo(a.id)">{{ a.id }}</td>
          <td>
            {{
              a.service_provider.user.first_name +
                " " +
                a.service_provider.user.last_name
            }}
          </td>
          <td>{{ a.updated_at | date : "mediumDate" }}</td>
          <td>
            <span class="status" [ngClass]="a.availability_status.name">
              {{ a.availability_status.name }}
            </span>
          </td>
        </tr>
      </ng-container>
      <!-- Pending -->
      <ng-container *ngIf="activeFilter === 'Pending'">
        <ng-container *ngFor="let p of pending">
          <tr
            *ngFor="
              let sp of p.service_provider.service_provider_pending_services
            "
          >
            <td>{{ sp.id }}</td>
            <td>{{ p.first_name + " " + p.last_name }}</td>
            <td>{{ p.service_provider.updated_at | date : "mediumDate" }}</td>
            <td>
              <div class="pending-actions">
                <button
                  type="button"
                  class="action-btn approve"
                  (click)="approveOrdecline(sp.id, 1, '')"
                >
                  Approve
                </button>
                <button
                  type="button"
                  class="action-btn decline"
                  (click)="approveOrdecline(sp.id, 0, '')"
                >
                  Decline
                </button>
              </div>
            </td>
          </tr>
        </ng-container></ng-container
      >

      <!-- Approved -->
      <ng-container *ngIf="activeFilter === 'Approved'">
        <tr *ngFor="let a of app" (click)="goTo(a.id)">
          <td>{{ a.id }}</td>
          <td>{{ a.admin.first_name + " " + a.admin.last_name }}</td>
          <td>{{ a.updated_at | date : "mediumDate" }}</td>
          <td>
            <span class="status Active">Approved</span>
          </td>
        </tr>
      </ng-container>

      <!-- Declined -->
      <ng-container *ngIf="activeFilter === 'Declined'">
        <tr *ngFor="let d of dec" (click)="goTo(d.id)">
          <td>{{ d.id }}</td>
          <td>{{ d.admin.first_name + " " + d.admin.last_name }}</td>
          <td>{{ d.updated_at | date : "mediumDate" }}</td>
          <td>
            <span class="status Rejected">Declined</span>
          </td>
        </tr>
      </ng-container>
    </tbody>
  </table>

  <!-- Mobile -->
  <div class="providers-cards">
    <div class="provider-card" *ngFor="let sp of pending">
      <div class="row">
        <span class="label">Service Provider:</span>
        <span class="value">{{ sp.id }}</span>
      </div>
      <div class="row">
        <span class="label">Owner:</span>
        <span class="value">{{ sp.first_name + sp.last_name }}</span>
      </div>
      <div class="row">
        <span class="label">Date:</span>
        <span class="value">{{
          sp.service_provider.updated_at | date : "mediumDate"
        }}</span>
      </div>
      <div class="row">
        <span class="label">Status:</span>
        <span class="value">
          <ng-container
            *ngIf="activeFilter === 'Pending'; else normalStatusMobile"
          >
            <div class="actions">
              <button
                type="button"
                class="action-btn approve"
                (click)="approveOrdecline(sp.id, 1, '')"
              >
                Approve
              </button>
              <button
                type="button"
                class="action-btn decline"
                (click)="approveOrdecline(sp.id, 0, '')"
              >
                Decline
              </button>
            </div>
          </ng-container>

          <ng-template #normalStatusMobile>
            <span class="status" [ngClass]="activeFilter.toLowerCase()">
              {{ activeFilter }}
            </span>
          </ng-template>
        </span>
      </div>
    </div>
  </div>
</div>
