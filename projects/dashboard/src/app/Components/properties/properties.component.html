<app-navbar></app-navbar>
<div class="properties-status">
  <div class="header">
    <h2>Properties Status</h2>
    <span [ngClass]="topStatusClass">{{ topStatusLabel }}</span>
  </div>

  <div class="tabs" role="tablist">
    <button
      *ngFor="let t of tabs"
      type="button"
      class="tab"
      [class.active]="t === activeFilter"
      (click)="setFilter(t)"
      [attr.aria-pressed]="t === activeFilter"
    >
      {{ t }}
    </button>
  </div>

  <table class="properties-table">
    <colgroup>
      <col style="width: 47%" />
      <col style="width: 18%" />
      <col style="width: 15%" />
      <col style="width: 20%" />
    </colgroup>
    <thead>
      <tr>
        <th *ngIf="activeFilter === 'Pending'">Property</th>
        <th *ngIf="activeFilter !== 'Pending'">Location</th>
        <th *ngIf="activeFilter !== 'Pending'">Admin</th>
        <th>Owner</th>
        <th>Date</th>
        <th *ngIf="activeFilter === 'All'">Status</th>
      </tr>
    </thead>
    <tbody>
      <ng-container *ngIf="activeFilter === 'Pending'">
        <tr *ngFor="let p of pendings">
          <td>{{ p.location.country.name + ", " + p.location.city.name }}</td>
          <td>{{ p.owner.first_name + " " + p.owner.last_name }}</td>
          <td>{{ p.owner.updated_at | date : "mediumDate" }}</td>
          <td>
            <ng-container *ngIf="activeFilter === 'Pending'">
              <div
                class="pending-actions"
                role="group"
                aria-label="Pending actions"
              >
                <button
                  type="button"
                  class="action-btn approve"
                  (click)="approveOrdecline(p.id, 1, '')"
                >
                  Approve
                </button>
                <button
                  type="button"
                  class="action-btn decline"
                  (click)="approveOrdecline(p.id, 0, '')"
                >
                  Decline
                </button>
              </div>
            </ng-container>
          </td>
        </tr>
      </ng-container>
      <ng-container *ngIf="activeFilter === 'Approved'">
        <tr *ngFor="let a of app">
          <td>{{ a.admin.first_name + " " + a.admin.last_name }}</td>
          <td>
            {{
              a.property.location.country.name +
                ", " +
                a.property.location.city.name
            }}
          </td>
          <td>
            {{ a.property.owner.first_name + " " + a.property.owner.last_name }}
          </td>
          <td>{{ a.property.owner.updated_at | date : "mediumDate" }}</td>
          <td>
            <span class="status approved">Approved</span>
          </td>
        </tr>
      </ng-container>
      <ng-container *ngIf="activeFilter === 'Declined'">
        <tr *ngFor="let d of dec">
          <td>{{ d.admin.first_name + " " + d.admin.last_name }}</td>
          <td>
            {{
              d.property.location.country.name +
                ", " +
                d.property.location.city.name
            }}
          </td>

          <td>
            {{ d.property.owner.first_name + " " + d.property.owner.last_name }}
          </td>
          <td>{{ d.property.owner.updated_at | date : "mediumDate" }}</td>
          <td>
            <span class="status declined">Declined</span>
          </td>
        </tr>
      </ng-container>
    </tbody>
  </table>

  <!-- Mobile -->
  <div class="properties-cards">
    <div class="property-card" *ngFor="let p of pendings">
      <div class="row">
        <span class="label">Property:</span>
        <span class="value">{{
          p.location.country.name + ", " + p.location.city.name
        }}</span>
      </div>
      <div class="row">
        <span class="label">Owner:</span>
        <span class="value">{{
          p.owner.first_name + " " + p.owner.last_name
        }}</span>
      </div>
      <div class="row">
        <span class="label">Date:</span>
        <span class="value">{{
          p.owner.updated_at | date : "mediumDate"
        }}</span>
      </div>
      <div class="row">
        <span class="label">Status:</span>
        <span class="value">
          <ng-container
            *ngIf="activeFilter === 'Pending'; else normalStatusMobile"
          >
            <div class="actions">
              <button
                type="button"
                class="action-btn approve"
                (click)="approveOrdecline(p.id, 1, '')"
              >
                Approve
              </button>
              <button
                type="button"
                class="action-btn decline"
                (click)="approveOrdecline(p.id, 0, '')"
              >
                Decline
              </button>
            </div>
          </ng-container>

          <ng-template #normalStatusMobile>
            <span
              class="status"
              [ngClass]="
                activeFilter.charAt(0).toLowerCase() + activeFilter.slice(1)
              "
            >
              {{ activeFilter }}
            </span>
          </ng-template>
        </span>
      </div>
    </div>
    <div class="property-card" *ngFor="let a of app">
      <div class="row">
        <span class="label">Property:</span>
        <span class="value">{{
          a.admin.first_name + " " + a.admin.last_name
        }}</span>
      </div>
      <div class="row">
        <span class="label">Owner:</span>
        <span class="value">{{
          a.admin.first_name + " " + a.admin.last_name
        }}</span>
      </div>
      <div class="row">
        <span class="label">Date:</span>
        <span class="value">{{
          a.property.owner.updated_at | date : "mediumDate"
        }}</span>
      </div>
      <div class="row">
        <span class="label">Status:</span>
        <span class="value">
          <span
            class="status"
            [ngClass]="
              activeFilter.charAt(0).toLowerCase() + activeFilter.slice(1)
            "
          >
            {{ activeFilter }}
          </span>
        </span>
      </div>
    </div>
    <div class="property-card" *ngFor="let p of pendings">
      <div class="row">
        <span class="label">Property:</span>
        <span class="value">{{ p.id }}</span>
      </div>
      <div class="row">
        <span class="label">Owner:</span>
        <span class="value">{{
          p.owner.first_name + " " + p.owner.last_name
        }}</span>
      </div>
      <div class="row">
        <span class="label">Date:</span>
        <span class="value">{{
          p.owner.updated_at | date : "mediumDate"
        }}</span>
      </div>
      <div class="row">
        <span class="label">Status:</span>
        <span class="value">
          <ng-container
            *ngIf="activeFilter === 'Pending'; else normalStatusMobile"
          >
            <div class="actions">
              <button
                type="button"
                class="action-btn approve"
                (click)="approveOrdecline(p.id, 1, '')"
              >
                Approve
              </button>
              <button
                type="button"
                class="action-btn decline"
                (click)="approveOrdecline(p.id, 0, '')"
              >
                Decline
              </button>
            </div>
          </ng-container>

          <ng-template #normalStatusMobile>
            <span
              class="status"
              [ngClass]="
                activeFilter.charAt(0).toLowerCase() + activeFilter.slice(1)
              "
            >
              {{ activeFilter }}
            </span>
          </ng-template>
        </span>
      </div>
    </div>
  </div>
</div>
