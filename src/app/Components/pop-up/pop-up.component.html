<div class="popup-overlay" (click)="closePopup()">
  <div
    *ngIf="page === 'details'"
    class="popup-container"
    (click)="$event.stopPropagation()"
  >
    <div class="filter-header">
      <p class="font-600 font-16 filters-title">Filters</p>
      <button class="close-btn" (click)="closePopup()">&times;</button>
    </div>
    <div class="nav-line"></div>

    <label *ngFor="let reason of report_reasons">
      <input
        type="radio"
        name="reportReason"
        [value]="reason.id"
        (change)="selectReportReason(reason.id)"
        [checked]="selectedReportReason === reason.id"
      />
      {{ reason.name }}
    </label>
  </div>
  <div
    *ngIf="page === 'filters'"
    class="popup-container"
    (click)="$event.stopPropagation()"
  >
    <div class="filter-header">
      <p class="font-600 font-16 filters-title">Filters</p>
      <button class="close-btn" (click)="closePopup()">&times;</button>
    </div>
    <div class="nav-line"></div>
    <div class="filter-options">
      <div class="filter-section">
        <p class="font-600 title">Location</p>

        <div *ngIf="countriesLoaded">
          <select
            [(ngModel)]="filterValues.country_id"
            (ngModelChange)="onCountrySelectChange($event)"
          >
            <option
              *ngFor="let country of displayedCountries; trackBy: trackById"
              [value]="country.id"
            >
              {{ country.name }}
            </option>
          </select>
        </div>

        <div class="filter-subsection">
          <p class="font-600 title">City</p>
          <div class="checkbox-group">
            <label *ngFor="let city of displayedCities; trackBy: trackById">
              <input
                type="radio"
                name="city"
                [value]="city.id"
                [(ngModel)]="filterValues.city_id"
              />
              {{ city.name }}
            </label>

            <p *ngIf="countriesLoaded && displayedCities.length === 0">
              No cities available for this country.
            </p>
          </div>
        </div>
      </div>

      <ng-container *ngIf="selectedType === 'rent'">
        <div class="filter-section">
          <p class="font-600 title">Area (m²)</p>
          <input
            type="number"
            placeholder="Min area"
            [(ngModel)]="filterValues.min_area"
          />
          <input
            type="number"
            placeholder="Max area"
            [(ngModel)]="filterValues.max_area"
          />
        </div>
        <div class="filter-section">
          <p class="font-600 title">Bathrooms</p>
          <input type="number" [(ngModel)]="filterValues.bathrooms" />
        </div>
        <div class="filter-section">
          <p class="font-600 title">Balconies</p>
          <input type="number" [(ngModel)]="filterValues.balconies" />
        </div>
        <div class="filter-section">
          <p class="font-600 title">Amenities</p>
          <label *ngFor="let amenity of amenities">
            <input
              type="checkbox"
              [value]="amenity.id"
              (change)="toggleAmenity(amenity.id)"
            />
            {{ amenity.name }}
          </label>
        </div>
        <div class="filter-section">
          <p class="font-600 title">Price (USD)</p>
          <input
            type="number"
            placeholder="Min price"
            [(ngModel)]="filterValues.min_price"
          />
          <input
            type="number"
            placeholder="Max price"
            [(ngModel)]="filterValues.max_price"
          />
        </div>
        <div class="filter-section">
          <p class="font-600 title">Furnished</p>
          <label
            ><input
              type="radio"
              [value]="1"
              [(ngModel)]="filterValues.is_furnished"
            />
            Yes</label
          >
          <label
            ><input
              type="radio"
              [value]="0"
              [(ngModel)]="filterValues.is_furnished"
            />
            No</label
          >
        </div>
        <div class="filter-section">
          <p class="font-600 title">Lease Period</p>
          <select [(ngModel)]="filterValues.lease_period">
            <option value="Yearly">Yearly</option>
            <option value="Monthly">Monthly</option>
          </select>
        </div>
      </ng-container>

      <!-- PURCHASE -->
      <ng-container *ngIf="selectedType === 'purchase'">
        <div class="filter-section">
          <p class="font-600 title">Area (m²)</p>
          <input
            type="number"
            placeholder="Min area"
            [(ngModel)]="filterValues.min_area"
          />
          <input
            type="number"
            placeholder="Max area"
            [(ngModel)]="filterValues.max_area"
          />
        </div>
        <div class="filter-section">
          <p class="font-600 title">Bathrooms</p>
          <input type="number" [(ngModel)]="filterValues.bathrooms" />
        </div>
        <div class="filter-section">
          <p class="font-600 title">Balconies</p>
          <input type="number" [(ngModel)]="filterValues.balconies" />
        </div>
        <div class="filter-section">
          <p class="font-600 title">Amenities</p>
          <label *ngFor="let amenity of amenities">
            <input
              type="checkbox"
              [value]="amenity.id"
              (change)="toggleAmenity(amenity.id)"
            />
            {{ amenity.name }}
          </label>
        </div>
        <div class="filter-section">
          <p class="font-600 title">Price (USD)</p>
          <input
            type="number"
            placeholder="Min price"
            [(ngModel)]="filterValues.min_price"
          />
          <input
            type="number"
            placeholder="Max price"
            [(ngModel)]="filterValues.max_price"
          />
        </div>
        <div class="filter-section">
          <p class="font-600 title">Furnished</p>
          <label
            ><input
              type="radio"
              [value]="1"
              [(ngModel)]="filterValues.is_furnished"
            />
            Yes</label
          >
          <label
            ><input
              type="radio"
              [value]="0"
              [(ngModel)]="filterValues.is_furnished"
            />
            No</label
          >
        </div>
      </ng-container>

      <!-- OFF‑PLAN -->
      <ng-container *ngIf="selectedType === 'off-plan'">
        <!-- reuse base fields -->
        <div class="filter-section">
          <p class="font-600 title">Area (m²)</p>
          <input
            type="number"
            placeholder="Min area"
            [(ngModel)]="filterValues.min_area"
          />
          <input
            type="number"
            placeholder="Max area"
            [(ngModel)]="filterValues.max_area"
          />
        </div>
        <div class="filter-section">
          <p class="font-600 title">Area (m²)</p>
          <input
            type="number"
            placeholder="Min area"
            [(ngModel)]="filterValues.min_area"
          />
          <input
            type="number"
            placeholder="Max area"
            [(ngModel)]="filterValues.max_area"
          />
        </div>
        <div class="filter-section">
          <p class="font-600 title">Bathrooms</p>
          <input type="number" [(ngModel)]="filterValues.bathrooms" />
        </div>
        <div class="filter-section">
          <p class="font-600 title">Balconies</p>
          <input type="number" [(ngModel)]="filterValues.balconies" />
        </div>
        <div class="filter-section">
          <p class="font-600 title">Amenities</p>
          <label *ngFor="let amenity of amenities">
            <input
              type="checkbox"
              [value]="amenity.id"
              (change)="toggleAmenity(amenity.id)"
            />
            {{ amenity.name }}
          </label>
        </div>
        <div class="filter-section">
          <p class="font-600 title">Price (USD)</p>
          <input
            type="number"
            placeholder="Min price"
            [(ngModel)]="filterValues.min_price"
          />
          <input
            type="number"
            placeholder="Max price"
            [(ngModel)]="filterValues.max_price"
          />
        </div>
        <div class="filter-section">
          <p class="font-600 title">First Payment (USD)</p>
          <input
            type="number"
            placeholder="Min first pay"
            [(ngModel)]="filterValues.min_first_pay"
          />
          <input
            type="number"
            placeholder="Max first pay"
            [(ngModel)]="filterValues.max_first_pay"
          />
        </div>
        <div class="filter-section">
          <p class="font-600 title">Delivery Year</p>
          <input type="number" [(ngModel)]="filterValues.delivery_date" />
        </div>
      </ng-container>

      <div class="filter-footer">
        <button class="search-btn" (click)="applyFilters()">
          Apply Filters
        </button>
      </div>
    </div>
  </div>
</div>
